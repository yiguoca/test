input {
    dead_letter_queue {
        path => "/usr/share/logstash/data/dead_letter_queue"
        commit_offsets => "true"
    }
}

filter {
    prune {
        whitelist_names => [ "^failed_message$" ]
    }
}

output {
    elasticsearch {
        # only .svc as the eck generated CA cert does not include our domain
        hosts => ["${ES_HOSTS}"]
        # Index is not required since we are using ILM which has an index associated already.
        #index => "%{[@metadata][target_index]}"
        user => "${ES_USER}"
        password => "${ES_PASSWORD}"
        ssl => "true"
        ssl_certificate_verification => "true"
        cacert => "/etc/logstash/certificates/ca.crt"
        ilm_enabled => "true"
        ilm_rollover_alias => "dead-letter"
        ilm_policy => "dead-letter"
        ilm_pattern => "dead-letter-*"
        index => "dead-letter-%{+YYYY.MM.dd}"
        http_compression => "true"
    }
}
